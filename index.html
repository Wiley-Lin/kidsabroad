<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Converter</title>

<style>
:root{
  --bg:#F2EFEA;
  --card:rgba(255,255,255,.92);
  --ink:#2F2F2F;
  --muted:#6D6D6D;
  --line:rgba(47,47,47,.10);
  --shadow:0 8px 20px rgba(47,47,47,.08);
  --radius:18px;

  --m1:#C9B7A8;
  --m2:#A9B7AE;
  --m3:#B7A8B5;
  --m4:#A8B2C5;
  --m5:#D7C9B6;
}

*{box-sizing:border-box;}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Noto Sans TC","Microsoft JhengHei",sans-serif;
  background:var(--bg);
  color:var(--ink);
}

.wrap{
  max-width:980px;
  margin:auto;
  padding:20px 16px 40px;
}

.topbar{
  display:flex;
  justify-content:flex-end;
  margin-bottom:14px;
}

button{
  border:1px solid var(--line);
  background:white;
  padding:8px 14px;
  border-radius:999px;
  cursor:pointer;
  box-shadow:0 6px 16px rgba(47,47,47,.06);
}
button:active{ transform:translateY(1px); }

.grid{
  display:grid;
  grid-template-columns:repeat(12,1fr);
  gap:14px;
}

.card{
  grid-column:span 6;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:18px;
  box-shadow:var(--shadow);
  position:relative;
}

.card.wide{ grid-column:span 12; }

.card::before{
  content:"";
  position:absolute;
  left:0;top:0;bottom:0;
  width:8px;
  border-radius:18px 0 0 18px;
}

.c1::before{background:var(--m1);}
.c2::before{background:var(--m2);}
.c3::before{background:var(--m3);}
.c4::before{background:var(--m4);}
.c5::before{background:var(--m5);}

.header{
  font-weight:800;
  margin-bottom:12px;
  padding-left:6px;
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:baseline;
}

.header small{
  font-weight:600;
  color:var(--muted);
  font-size:12px;
}

.row{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  gap:10px;
  align-items:end;
  padding-left:6px;
}

.swap{
  width:40px;height:40px;
  display:grid;
  place-items:center;
  border:1px solid var(--line);
  border-radius:12px;
  background:white;
  color:var(--muted);
}

label{
  font-size:12px;
  color:var(--muted);
}

.field{
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px;
  display:flex;
  align-items:center;
  gap:8px;
  background:white;
}

input{
  border:0;
  outline:0;
  width:100%;
  font-size:15px;
  background:transparent;
  color:var(--ink);
}

.unit{
  font-size:12px;
  color:var(--muted);
}

.ftin{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.currency3{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
  padding-left:6px;
}

/* ---------- æ‰‹æ©Ÿå„ªåŒ– ---------- */

@media(max-width:860px){
  .card{grid-column:span 12;}
  .row{grid-template-columns:1fr;}
  .currency3{grid-template-columns:1fr;}
}

@media(max-width:520px){
  .wrap{padding:16px 12px 28px;}

  .header{
    flex-direction:column;
    align-items:flex-start;
    gap:6px;
  }

  .swap{display:none;}          /* æ‰‹æ©Ÿéš±è— â†” */

  .ftin{grid-template-columns:1fr;} /* ft/in ç›´æ’ */

  input{font-size:16px;} /* iOS ä¸ç¸®æ”¾ */
}

</style>
</head>

<body>
<div class="wrap">

<div class="topbar">
  <button id="clearBtn">ğŸ§¼ Clear</button>
</div>

<div class="grid">

<!-- cm â†” ft/in -->
<div class="card c1">
<div class="header"><span>ğŸ“ cm â†” ft / in</span></div>
<div class="row">
<div>
<label>cm</label>
<div class="field">
<input id="cm" type="number" step="any">
<span class="unit">cm</span>
</div>
</div>

<div class="swap">â†”</div>

<div>
<label>ft / in</label>
<div class="ftin">
<div class="field">
<input id="ft" type="number" step="1">
<span class="unit">ft</span>
</div>
<div class="field">
<input id="inch" type="number" step="any">
<span class="unit">in</span>
</div>
</div>
</div>
</div>
</div>

<!-- kg â†” lb -->
<div class="card c2">
<div class="header"><span>âš–ï¸ kg â†” lb</span></div>
<div class="row">
<div>
<label>kg</label>
<div class="field">
<input id="kg" type="number" step="any">
<span class="unit">kg</span>
</div>
</div>
<div class="swap">â†”</div>
<div>
<label>lb</label>
<div class="field">
<input id="lb" type="number" step="any">
<span class="unit">lb</span>
</div>
</div>
</div>
</div>

<!-- Â°C â†” Â°F -->
<div class="card c3">
<div class="header"><span>ğŸŒ¡ï¸ Â°C â†” Â°F</span></div>
<div class="row">
<div>
<label>Â°C</label>
<div class="field">
<input id="c" type="number" step="any">
<span class="unit">Â°C</span>
</div>
</div>
<div class="swap">â†”</div>
<div>
<label>Â°F</label>
<div class="field">
<input id="f" type="number" step="any">
<span class="unit">Â°F</span>
</div>
</div>
</div>
</div>

<!-- km â†” mi -->
<div class="card c4">
<div class="header"><span>ğŸ›£ï¸ km â†” mi</span></div>
<div class="row">
<div>
<label>km</label>
<div class="field">
<input id="km" type="number" step="any">
<span class="unit">km</span>
</div>
</div>
<div class="swap">â†”</div>
<div>
<label>mi</label>
<div class="field">
<input id="mi" type="number" step="any">
<span class="unit">mi</span>
</div>
</div>
</div>
</div>

<!-- USD / TWD / JPY -->
<div class="card c5 wide">
<div class="header">
<span>ğŸ’± USD â†” TWD â†” JPY</span>
<small id="fxStatus">ğŸŒ loading...</small>
</div>

<div class="currency3">
<div>
<label>ğŸ’µ USD</label>
<div class="field">
<input id="usd" type="number" step="any">
<span class="unit">USD</span>
</div>
</div>

<div>
<label>ğŸ’° TWD</label>
<div class="field">
<input id="twd" type="number" step="any">
<span class="unit">TWD</span>
</div>
</div>

<div>
<label>ğŸ’´ JPY</label>
<div class="field">
<input id="jpy" type="number" step="any">
<span class="unit">JPY</span>
</div>
</div>
</div>
</div>

</div>
</div>

<script>
const $=id=>document.getElementById(id);
const parse=el=>el.value===""?NaN:Number(el.value);
const set=(el,v,d=2)=>{if(!Number.isFinite(v)){el.value="";return;}el.value=(Math.round(v*10**d)/10**d);};
const g={};
function guard(k,f){if(g[k])return;g[k]=true;try{f();}finally{g[k]=false;}}

/* cm â†” ft/in */
$("cm").oninput=()=>guard("cm",()=>{
const cm=parse($("cm"));
if(!Number.isFinite(cm)){ $("ft").value="";$("inch").value="";return;}
const total=cm/2.54;
$("ft").value=Math.floor(total/12);
set($("inch"),total%12,1);
});
$("ft").oninput=$("inch").oninput=()=>guard("ft",()=>{
if(!$("ft").value && !$("inch").value){$("cm").value="";return;}
const ft=Number($("ft").value||0);
const inch=Number($("inch").value||0);
set($("cm"),(ft*12+inch)*2.54,2);
});

/* kg â†” lb */
const K=2.2046226218;
$("kg").oninput=()=>guard("kg",()=>set($("lb"),parse($("kg"))*K,2));
$("lb").oninput=()=>guard("lb",()=>set($("kg"),parse($("lb"))/K,2));

/* C â†” F */
$("c").oninput=()=>guard("c",()=>set($("f"),parse($("c"))*9/5+32,1));
$("f").oninput=()=>guard("f",()=>set($("c"),(parse($("f"))-32)*5/9,1));

/* km â†” mi */
const M=0.6213711922;
$("km").oninput=()=>guard("km",()=>set($("mi"),parse($("km"))*M,2));
$("mi").oninput=()=>guard("mi",()=>set($("km"),parse($("mi"))/M,2));

/* FX */
const FX_URL="https://open.er-api.com/v6/latest/USD";
const FX_CACHE_KEY="fx_cache_v4";
const FX_TTL=60*60*1000;
let fxRates=null;
let lastEdit=null;

function fmtTime(ts){
const d=new Date(ts);
const tz=Intl.DateTimeFormat().resolvedOptions().timeZone;
const y=d.getFullYear();
const m=String(d.getMonth()+1).padStart(2,"0");
const day=String(d.getDate()).padStart(2,"0");
const hh=String(d.getHours()).padStart(2,"0");
const mm=String(d.getMinutes()).padStart(2,"0");
const offset=-d.getTimezoneOffset();
const sign=offset>=0?"+":"-";
const abs=Math.abs(offset);
const oh=String(Math.floor(abs/60)).padStart(2,"0");
return `${y}-${m}-${day} ${hh}:${mm} ${tz} (GMT${sign}${oh})`;
}

function status(t){$("fxStatus").textContent=t;}

async function fetchFX(){
let cache=JSON.parse(localStorage.getItem(FX_CACHE_KEY)||"null");
let now=Date.now();
if(cache && now-cache.ts<FX_TTL){
fxRates=cache.rates;
status("âœ¨ updated "+fmtTime(cache.ts));
return;
}
try{
status("ğŸŒ updating...");
let r=await fetch(FX_URL);
let d=await r.json();
fxRates={TWD:d.rates.TWD,JPY:d.rates.JPY};
localStorage.setItem(FX_CACHE_KEY,JSON.stringify({ts:now,rates:fxRates}));
status("âœ¨ updated "+fmtTime(now));
}catch{
if(cache){
fxRates=cache.rates;
status("âš  cached "+fmtTime(cache.ts));
}else{
status("âŒ offline");
}
}
}

function recalc(){
if(!fxRates)return;
const usd=parse($("usd"));
const twd=parse($("twd"));
const jpy=parse($("jpy"));
guard("fx",()=>{
if(lastEdit==="usd" && isFinite(usd)){
set($("twd"),usd*fxRates.TWD,2);
set($("jpy"),usd*fxRates.JPY,2);
}
if(lastEdit==="twd" && isFinite(twd)){
let base=twd/fxRates.TWD;
set($("usd"),base,2);
set($("jpy"),base*fxRates.JPY,2);
}
if(lastEdit==="jpy" && isFinite(jpy)){
let base=jpy/fxRates.JPY;
set($("usd"),base,2);
set($("twd"),base*fxRates.TWD,2);
}
});
}

$("usd").oninput=()=>{lastEdit="usd";recalc();}
$("twd").oninput=()=>{lastEdit="twd";recalc();}
$("jpy").oninput=()=>{lastEdit="jpy";recalc();}

fetchFX();
setInterval(fetchFX,FX_TTL);

/* clear */
$("clearBtn").onclick=()=>{
["cm","ft","inch","kg","lb","c","f","km","mi","usd","twd","jpy"].forEach(id=>$(id).value="");
};
</script>

</body>
</html>
